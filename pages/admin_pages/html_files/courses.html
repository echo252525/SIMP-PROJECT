<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Admin – Courses</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css_files/sideBar.css" />
    <style>
      :root {
        --ink: #1c2430;
        --muted: #6c7a8a;
        --line: #e7edf3;
        --brand: #20a44c;
        --danger: #e53935;
        --card: #ffffff;
        --bg: #f8fbfd;
        --radius: 14px;
        --border: #e5e7eb;
      }
      body {
        background: var(--bg);
      }
      main {
        margin-top: 1.4rem;
      }

      .page-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1rem;
      }
      .page-header h1 {
        color: var(--ink);
      }
      .page-header .actions {
        display: flex;
        gap: 10px;
      }
      .btn {
        border: 1px solid var(--brand);
        background: var(--brand);
        color: #fff;
        padding: 10px 14px;
        border-radius: 999px;
        cursor: pointer;
      }
      .btn.secondary {
        background: #fff;
        color: #0f172a;
        border-color: #d1e7db;
      }
      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
      }
      @media (max-width: 860px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }

      .course-card {
        display: flex;
        gap: 16px;
        align-items: center;
        border: 1px solid var(--border);
        background: #fff;
        border-radius: 16px;
        padding: 14px 18px;
        box-shadow: 0 4px 14px rgba(0, 0, 0, 0.06);
      }
      .course-image {
        flex: 0 0 220px;
        height: 120px;
        border-radius: 12px;
        overflow: hidden;
        background: #f2f4f7;
      }
      .course-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }
      .course-content {
        display: flex;
        flex-direction: column;
        gap: 8px;
        min-width: 0;
        flex: 1 1 auto;
      }
      .course-content h3 {
        margin: 0;
        font-size: 18px;
        color: #1f2937;
      }
      .course-content p {
        margin: 0;
        color: #6b7280;
        font-size: 13px;
        line-height: 1.4;
      }
      .meta {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        font-size: 12px;
        color: #6b7280;
      }
      .pill {
        background: #eef6ff;
        color: #0f172a;
        padding: 4px 10px;
        border-radius: 999px;
        border: 1px solid #d7e7ff;
      }
      .right {
        margin-left: auto;
        display: flex;
        flex-direction: column;
        gap: 8px;
        align-items: flex-end;
      }
      .small {
        font-size: 12px;
        color: #7a7a7a;
      }
      .link {
        color: var(--brand);
        text-decoration: none;
        font-weight: 600;
      }
      .empty {
        border: 1px dashed #cbd5e1;
        border-radius: 16px;
        padding: 20px;
        text-align: center;
        color: #6b7280;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Sidebar -->
      <aside>
        <div class="toggle">
          <div class="logo">
            <img src="../../../img/simpLogo.png" />
            <h2>SIMP<span class="danger">Project</span></h2>
          </div>
          <div class="close" id="close-btn">
            <span class="material-icons-sharp">close</span>
          </div>
        </div>

        <div class="sidebar">
          <a href="dashboard.html">
            <span class="material-icons-sharp">dashboard</span>
            <h3>Dashboard</h3>
          </a>
          <a href="workerVerification.html">
            <span class="material-icons-sharp">engineering</span>
            <h3>Workers<br>Verification</h3>
          </a>
          <a href="jobVerification.html">
            <span class="material-icons-sharp">work</span>
            <h3>Jobs<br>Verification</h3>
          </a>
          <a href="adminVerification.html">
            <span class="material-icons-sharp">shield</span>
            <h3>Admin<br>Verification</h3>
          </a>
          <a href="courses.html" class="active">
            <span class="material-icons-sharp">school</span>
            <h3>Course<br>Publisher</h3>
          </a>
          <a href="#">
            <span class="material-icons-sharp">settings</span>
            <h3>Settings</h3>
          </a>
          
          <a href="#" id="logout-btn">
            <span class="material-icons-sharp">logout</span>
            <h3>Logout</h3>
          </a>
        </div>
      </aside>

      <!-- Main -->
      <main>
        <div class="page-header">
          <div>
            <h1>Courses (Admin)</h1>
            <p class="small">Create, edit, and manage your courses.</p>
          </div>
          <div class="actions">
            <button id="addCourseBtn" class="btn">+ Add Course</button>
            <button id="refreshBtn" class="btn secondary">Refresh</button>
          </div>
        </div>

        <div id="coursesGrid" class="grid">
          <!-- populated by JS -->
        </div>

        <div id="emptyState" class="empty" style="display: none">
          No courses yet. Click <strong>+ Add Course</strong> to create your
          first one.
        </div>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
      // ----- CONFIG -----
      const SUPABASE_URL = "https://gxydxmobwrccqagltlci.supabase.co";
      const SUPABASE_ANON_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd4eWR4bW9id3JjY3FhZ2x0bGNpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxNDMzOTMsImV4cCI6MjA3MDcxOTM5M30.Zk2xUlmlPGbe-7rDsqC486Js9LGFMMOp-fytNZSwzBs";

      // Lock schema to 'courses' so we can use .from('course') etc.
      const supabase = window.supabase.createClient(
        SUPABASE_URL,
        SUPABASE_ANON_KEY,
        { db: { schema: "courses" } }
      );

      const addBtn = document.getElementById("addCourseBtn");
      const refreshBtn = document.getElementById("refreshBtn");
      const grid = document.getElementById("coursesGrid");
      const emptyState = document.getElementById("emptyState");

      addBtn.addEventListener("click", () => {
        window.location.href = "courseBuilder.html";
      });
      refreshBtn.addEventListener("click", loadCourses);

      function el(tag, attrs = {}, children = []) {
        const n = document.createElement(tag);
        Object.entries(attrs).forEach(([k, v]) => {
          if (k === "class") n.className = v;
          else if (k === "html") n.innerHTML = v;
          else n.setAttribute(k, v);
        });
        children.forEach((c) => n.appendChild(c));
        return n;
      }

      async function loadCourses() {
        grid.innerHTML = "";
        const { data, error } = await supabase
          .from("course")
          .select(
            "id,title,slug,description,level,tags,thumbnail_url,created_at,updated_at"
          )
          .order("created_at", { ascending: false });

        if (error) {
          console.error(error);
          grid.appendChild(
            el("div", {
              class: "empty",
              html: `Error loading courses: ${error.message}`,
            })
          );
          return;
        }
        if (!data || data.length === 0) {
          emptyState.style.display = "";
          return;
        }
        emptyState.style.display = "none";

        data.forEach((c) => {
          const card = el("div", { class: "course-card" }, [
            el("div", { class: "course-image" }, [
              el("img", {
                src: c.thumbnail_url || "../images/profile-4.jpg",
                alt: c.title,
              }),
            ]),
            el("div", { class: "course-content" }, [
              el("h3", { html: c.title }),
              el("p", { html: c.description || "No description." }),
              el("div", { class: "meta" }, [
                el("span", { class: "pill", html: `Slug: ${c.slug}` }),
                el("span", { class: "pill", html: `Level: ${c.level ?? 0}` }),
                el("span", {
                  class: "pill",
                  html: `Tags: ${(c.tags || []).join(", ") || "—"}`,
                }),
              ]),
            ]),
            el("div", { class: "right" }, [
              el("span", {
                class: "small",
                html: new Date(c.created_at).toLocaleString(),
              }),
              el("a", {
                class: "link",
                href: `courseBuilder.html?course=${encodeURIComponent(
                  c.id
                )}`,
                html: "Edit",
              }),
            ]),
          ]);
          grid.appendChild(card);
        });
      }

      document.addEventListener("DOMContentLoaded", loadCourses);
    </script>
    <script src="../../general_files/index.js"></script>
    <script type="module" src="../../general_files/session.js"></script>
  </body>
</html>
