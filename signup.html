<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet" />
  <title>SIMP Project – Sign Up</title>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&display=swap");

    :root {
      --azure-blue: #20647c;
      --green: #20a44c;
      --card-bg: rgba(255, 255, 255, 0.18);
      --glass-border: 1px solid rgba(255, 255, 255, 0.32);
      --shadow: 0 24px 60px rgba(17, 24, 39, 0.15);
      --ink: #111827;
      --muted: #475569;

      --step-idle: #e5e7eb;
      --step-active: #4f46e5;
      --step-done: #22c55e;
      --connector: #e5e7eb;
      --connector-fill: linear-gradient(90deg, #4f46e5, #22c55e);
    }

    * {
      padding: 0;
      margin: 0;
      box-sizing: border-box;
      font-family: "Raleway", sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, #f8fbfd, #e7edf3);
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    /* ===== Slider Shell (kept responsive & capped to viewport) ===== */
    .auth-shell {
      position: relative;
      width: min(980px, 94vw);
      height: min(92vh, 820px);
      border-radius: 26px;
      background: #ffffff;
      box-shadow: 0 24px 60px rgba(17, 24, 39, 0.15);
      overflow: hidden;
    }

    .side {
      position: absolute;
      inset: 0;
      display: grid;
      grid-template-columns: 1fr 1fr;
    }

    .side .pane {
      padding-inline: clamp(22px, 4.6vw, 46px);
      padding-block: clamp(26px, 6vh, 44px);
      display: grid;
      place-items: center;
      text-align: center;
      color: #fff;
    }

    .pane h1 {
      font-size: clamp(26px, 3.2vw, 38px);
      line-height: 1.15;
      margin-bottom: 8px;
      color: #fff;
      font-weight: 800;
    }

    .pane p {
      color: #f5f7fb;
      max-width: 420px;
      font-size: 15px;
      line-height: 1.6;
      margin: 8px auto 20px;
    }

    .ghost-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 12px 26px;
      border-radius: 999px;
      font-weight: 700;
      border: 2px solid rgba(255, 255, 255, 0.55);
      background: rgba(255, 255, 255, 0.06);
      color: #fff;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.25s ease,
        border-color 0.25s ease, background 0.25s ease;
      user-select: none;
    }

    .ghost-btn:hover {
      box-shadow: 0 10px 26px rgba(0, 0, 0, 0.12);
      border-color: #fff;
      background: rgba(255, 255, 255, 0.12);
    }

    .ghost-btn:active {
      transform: translateY(1px);
    }

    .left-grad {
      background: linear-gradient(135deg, #20a44c, #20647c);
    }

    .right-grad {
      background: linear-gradient(135deg, #20a44c, #20647c);
    }

    /* ===== Glass form ===== */
    .signupDiv {
      position: absolute;
      inset: 0;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      margin: auto;
      width: 100%;
      max-width: 500px;
      display: grid;
      grid-template-rows: auto auto minmax(0, 1fr) auto;
      gap: 8px;
      padding: 3rem 2.5rem;
      background-color: white;
      z-index: 2;
      transition: transform 0.55s cubic-bezier(0.2, 0.8, 0.2, 1);
      overflow: hidden;
    }

    .mode-installer .signupDiv {
      transform: translateX(-50%);
    }

    .mode-customer .signupDiv {
      transform: translateX(50%);
    }

    .signupDiv .backBtn {
      width: 40px;
      height: 40px;
      display: grid;
      place-items: center;
      border: none;
      background: transparent;
      color: black;
      cursor: pointer;
    }

    .simpLogo {
      display: grid;
      place-items: center;
      margin-top: 4px;
    }

    .simpLogo img {
      width: 3.6rem;
    }

    .signupDivHeader {
      display: grid;
      place-items: center;
      gap: 0.5rem;
      margin-bottom: 4px;
    }

    h2 {
      text-align: center;
      font-weight: 900;
      font-size: 36px;
    }

    .role-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #eef2f7;
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 700;
      color: #111827;
    }

    h2,
    h3 {
      color: black;
      margin-bottom: 8px;
    }

    /* Stepper */
    .progress-wrap {
      margin: 4px 2px 6px;
    }

    .hidden {
      display: none !important;
    }

    .stepper {
      display: grid;
      grid-template-columns: 1fr auto 1fr auto 1fr;
      align-items: center;
      gap: 8px;
      user-select: none;
    }

    .step {
      display: grid;
      justify-items: center;
      gap: 6px;
      color: var(--muted);
      text-align: center;
    }

    .step .dot {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--step-idle);
      display: grid;
      place-items: center;
      font-weight: 800;
      font-size: 14px;
      color: #0b1020;
      box-shadow: inset 0 0 0 2px rgba(0, 0, 0, 0.04);
      transition: background 0.25s ease, color 0.25s ease, transform 0.2s ease;
    }

    .step.active .dot {
      background: var(--step-active);
      color: #fff;
      transform: scale(1.05);
    }

    .step.done .dot {
      background: var(--step-done);
      color: #fff;
    }

    .step label {
      font-size: 12px;
      color: var(--muted);
    }

    .step.active label {
      color: var(--ink);
      font-weight: 700;
    }

    .connector {
      position: relative;
      height: 4px;
      border-radius: 999px;
      background: var(--connector);
      overflow: hidden;
    }

    .connector::after {
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 0%;
      background: var(--connector-fill);
      transition: width 0.35s ease;
    }

    .connector.fill-0::after {
      width: 0%;
    }

    .connector.fill-50::after {
      width: 50%;
    }

    .connector.fill-100::after {
      width: 100%;
    }

    /* Scroll area */
    .form-scroll {
      min-height: 0;
      padding: 8px 4px 6px;
    }

    .form-scroll::-webkit-scrollbar {
      width: 8px;
    }

    .form-scroll::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.12);
      border-radius: 10px;
    }

    .form-scroll::-webkit-scrollbar-track {
      background: transparent;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .row-1 {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    label {
      font-size: 14px;
      color: #333;
      display: block;
      margin-top: 6px;
    }

    input,
    select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #cfd6df;
      border-radius: 10px;
      outline: none;
      background: #fff;
    }

    .actions {
      display: flex;
      gap: 10px;
      margin-top: 14px;
    }

    button {
      padding: 10px 16px;
      border: 0;
      border-radius: 10px;
      cursor: pointer;
    }

    .btn-secondary {
      background: #e5e7eb;
      position: relative;
    }

    .btn-primary {
      background: #20a44c;
      color: #fff;
      font-weight: 800;
      transition: background 0.3s ease;
      position: relative;
    }

    .btn-primary:hover {
      background: #1a7f3a;
    }

    .btn-secondary:active,
    .btn-primary:active {
      top: 2px;
      left: 1px;
    }

    .auth-footer {
      text-align: center;
      padding-top: 0.6rem;
      margin-top: 0.4rem;
      font-size: 0.9rem;
      border-top: 1px solid #e6e8ee;
    }

    .auth-footer a {
      text-decoration: none;
      color: var(--azure-blue);
    }

    .auth-footer a:active {
      color: var(--green);
    }

    @keyframes fade {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .form-step {
      display: none;
      animation: fade 200ms ease;
    }

    .form-step.active {
      display: block;
    }

    /* Modal */
    #emailConfirmModal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    #emailConfirmModal .modal-content {
      background: white;
      padding: 24px;
      border-radius: 12px;
      text-align: center;
      max-width: 400px;
    }

    #emailConfirmModal h3 {
      margin-bottom: 12px;
    }

    #emailConfirmModal p {
      margin-bottom: 20px;
      font-size: 14px;
      color: #444;
    }

    /* ===== Tiny mobile tabs (appear only on small screens) ===== */
    .role-tabs {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      top: 10px;
      z-index: 3;
      background-color: #f5f7fb;
      border: 1px solid #e6e8ee;
      border-radius: 999px;
      padding: 6px;
      display: none;
      gap: 6px;
      box-shadow: 0 8px 20px rgba(17, 24, 39, 0.08);
    }

    .role-tabs button {
      padding: 8px 14px;
      border-radius: 999px;
      border: 0;
      background: transparent;
      font-weight: 800;
      font-size: 13px;
      color: #475569;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 10rem;
    }

    .role-tabs button.active {
      background: linear-gradient(135deg, #20a44c, #20647c);
      color: #ffffff;
      box-shadow: 0 6px 14px rgba(17, 24, 39, 0.08);
    }

    /* ===== Responsive (Mobile first) ===== */
    @media only screen and (max-width: 820px) {
      /* Off-canvas the big panels to keep the animation but save space */
      .side {
        transform: translateY(-100%);
        opacity: 0;
        pointer-events: none;
        transition: transform 0.4s ease, opacity 0.4s ease;
      }

      /* Show compact top tabs that call your existing functions */
      .role-tabs {
        display: flex;
      }

      .auth-shell {
        height: min(92vh, 800px);
      }

      .signupDiv {
        position: relative;
        max-width: 640px;
        width: 100%;
        padding: 60px 0px 18px;
        border-radius: 0;
      }

      /* Keep a subtle slide on mobile without pushing off-screen */
      .mode-installer .signupDiv {
        transform: translateX(-0%);
      }

      .mode-customer .signupDiv {
        transform: translateX(0%);
      }

      h2 {
        font-size: 26px;
      }

      h3 {
        font-size: 18px;
      }

      label {
        font-size: 13px;
      }

      .row {
        grid-template-columns: 1fr;
        gap: 10px;
      }

      input,
      select {
        padding: 10px 12px;
        border-radius: 12px;
      }

      .actions {
        gap: 8px;
      }

      .btn-primary,
      .btn-secondary {
        width: 100%;
        padding: 12px 14px;
        border-radius: 12px;
      }

      /* Stepper gets tighter */
      .step .dot {
        width: 26px;
        height: 26px;
        font-size: 13px;
      }

      .step label {
        font-size: 11px;
      }

      /* Make footer smaller */
      .auth-footer {
        font-size: 0.85rem;
        padding-bottom: 10px;
      }
    }

    @media only screen and (max-width: 431px) {
      .auth-shell {
        height: min(92vh, 750px);
        overflow-y: auto;
      }

      .signupDiv {
        padding: 60px 20px 18px;
      }

      .role-pill {
        font-size: 11px;
        padding: 5px 10px;
      }
    }
  </style>
</head>

<body class="mode-customer">
  <div class="auth-shell">
    <!-- Small mobile tabs (use same JS handlers) -->
    <div class="role-tabs" aria-label="Choose role">
      <button id="tabCustomer" class="active" type="button" onclick="window.chooseCustomerSignup()">
        Customer
      </button>
      <button id="tabInstaller" type="button" onclick="window.chooseInstallerSignup()">
        Installer
      </button>
    </div>

    <!-- Sliding gradient panels -->
    <div class="side">
      <div class="pane left-grad">
        <div>
          <img src="img/simpHappyMascotLogo.png" style="max-width: 100px; width: 95%" alt="SIMP Mascot" />
          <h1>Hello, Simpsters!</h1>
          <p>Click the button below to <strong>sign up as installer.</strong>
          </p>
          <button class="ghost-btn" onclick="window.chooseInstallerSignup()">
            SIGN UP AS INSTALLER
          </button>
        </div>
      </div>
      <div class="pane right-grad">
        <div>
          <img src="img/simpHappyMascotLogo.png" style="max-width: 100px; width: 95%" alt="SIMP Mascot" />
          <h1>Hello, Simpsters!</h1>
          <p>Click the button below to <strong>sign up as customer.</strong>
          </p>
          <button class="ghost-btn" onclick="window.chooseCustomerSignup()">
            SIGN UP AS CUSTOMER
          </button>
        </div>
      </div>
    </div>

    <!-- Glass signup form (scrolls internally if content is tall) -->
    <div class="signupDiv">
      <button class="backBtn" onclick="window.location.href='index.html'">
        <span class="material-icons-sharp">arrow_back</span>
      </button>

      <div class="signupDivHeader">
        <h2>Sign Up</h2>
        <div class="role-pill">
          <span class="material-icons-sharp" style="font-size: 16px">person</span>
          <span id="activeRoleText"></span>
        </div>
      </div>

      <!-- Installer-only stepper -->
      <div id="progressWrap" class="progress-wrap hidden">
        <div class="stepper">
          <div class="step" data-i="0">
            <div class="dot">1</div>
            <label>Personal</label>
          </div>
          <div id="conn01" class="connector fill-0"></div>
          <div class="step" data-i="1">
            <div class="dot">2</div>
            <label>Professional</label>
          </div>
          <div id="conn12" class="connector fill-0"></div>
          <div class="step" data-i="2">
            <div class="dot">3</div>
            <label>Bank</label>
          </div>
        </div>
      </div>

      <!-- Scrollable content area -->
      <div class="form-scroll">
        <!-- STEP 1: Personal Info -->
        <section class="form-step active" data-step="1" id="personalStep">
          <h3>Personal Info</h3>
          <div class="row">
            <div>
              <label>Full Name <input id="name" type="text" required /></label>
            </div>
            <div>
              <label>Birthdate <input id="birthdate" type="date" required /></label>
            </div>
          </div>
          <div class="row">
            <div>
              <label>Age <input id="age" type="number" readonly /></label>
            </div>
            <div>
              <label>Phone <input id="phone" type="tel" required /></label>
            </div>
          </div>
          <div class="row-1">
            <label>Email <input id="email" type="email" required /></label>
          </div>
          <div class="row-1">
            <label>Password
              <input id="password" type="password" minlength="6" required /></label>
          </div>

          <div class="actions">
            <button id="next1" class="btn-primary">Next</button>
            <button id="signUpNow" class="btn-primary hidden">Sign Up</button>
          </div>
        </section>

        <!-- STEP 2: Professional Details (Installer only) -->
        <section class="form-step" data-step="2" id="proStep">
          <h3>Professional Info</h3>
          <div class="row">
            <div>
              <label>Profession <input id="profession" type="text" /></label>
            </div>
            <div>
              <label>Highest Qualification
                <select id="highestQualification">
                  <option value="">Select…</option>
                  <option>High School</option>
                  <option>Vocational/Technical</option>
                  <option>Associate Degree</option>
                  <option>Bachelor’s</option>
                  <option>Master’s</option>
                  <option>Doctorate</option>
                  <option>Other</option>
                </select>
              </label>
            </div>
          </div>
          <div class="row">
            <div>
              <label>Employment Status
                <select id="employmentStatus">
                  <option value="">Select…</option>
                  <option value="Employed">Employed</option>
                  <option value="Self-Employed">Self-Employed</option>
                  <option value="Unemployed">Unemployed</option>
                  <option value="Student">Student</option>
                </select>
              </label>
            </div>
            <div id="employerWrap" class="hidden">
              <label>Company <input id="employer" type="text" /></label>
            </div>
          </div>
          <div class="row-1">
            <label>Main Income Source <input id="mainIncomeSource" type="text" /></label>
          </div>
          <div class="actions">
            <button id="back2" class="btn-secondary">Back</button>
            <button id="next2" class="btn-primary">Next</button>
          </div>
        </section>

        <!-- STEP 3: Bank Details (Installer only) -->
        <section class="form-step" data-step="3" id="bankStep">
          <h3>Bank Details</h3>
          <div class="row">
            <div>
              <label>Bank Name <input id="bankName" type="text" /></label>
            </div>
            <div>
              <label>Account Holder <input id="accountHolder" type="text" /></label>
            </div>
          </div>
          <div class="row-1">
            <label>Account Number <input id="accountNumber" type="text" /></label>
          </div>
          <div class="actions">
            <button id="back3" class="btn-secondary">Back</button>
            <button id="signUpBtn" class="btn-primary">Sign Up</button>
          </div>
        </section>
      </div>

      <div class="auth-footer">
        Already have an account? <a href="login.html">Log in here</a>
      </div>

      <!-- Email Confirmation Modal -->
      <div id="emailConfirmModal">
        <div class="modal-content">
          <h3>Confirm Your Email</h3>
          <p>
            We've sent a confirmation link to your email. Please check your
            inbox and click the link to activate your account.
          </p>
          <button id="goToEmailBtn" class="btn-primary">
            Go to My Email
          </button>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
    import { SUPABASE_URL, SUPABASE_ANON_KEY } from "/supabase.js";
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ===== State =====
    let selectedRole = null; // "customer" | "installer"

    const stepsAll = Array.from(document.querySelectorAll(".form-step"));
    const progressWrap = document.getElementById("progressWrap");

    function visibleSteps() {
      return stepsAll.filter((s) => !s.classList.contains("skipped"));
    }
    function currentIndex() {
      return visibleSteps().findIndex((s) => s.classList.contains("active"));
    }
    function showStepByIndex(i) {
      const vis = visibleSteps();
      vis.forEach((s, idx) => s.classList.toggle("active", idx === i));
      updateStepper();
    }
    function goNext() {
      const vis = visibleSteps();
      const i = currentIndex();
      if (i < vis.length - 1 && validateStep(vis[i])) showStepByIndex(i + 1);
    }
    function goBack() {
      const i = currentIndex();
      if (i > 0) showStepByIndex(i - 1);
    }

    //role pill
    function updateRolePill(role) {
      const el = document.getElementById("activeRoleText");
      if (!el) return;
      el.textContent =
        role === "installer"
          ? "You are now signing up as Installer"
          : "You are now signing up as Customer";
    }

    // Buttons
    document.getElementById("next1").addEventListener("click", () => {
      if (!validateStep(document.getElementById("personalStep"))) return;
      if (selectedRole === "installer") goNext();
      else document.getElementById("signUpNow").click();
    });
    document.getElementById("next2").addEventListener("click", () => {
      if (validateStep(document.getElementById("proStep"))) goNext();
    });
    document.getElementById("back2").addEventListener("click", goBack);
    document.getElementById("back3").addEventListener("click", goBack);

    // Employment toggle (installer)
    const employmentStatus = document.getElementById("employmentStatus");
    const employerWrap = document.getElementById("employerWrap");
    employmentStatus.addEventListener("change", () => {
      employerWrap.classList.toggle(
        "hidden",
        employmentStatus.value !== "Employed"
      );
    });

    // Age auto-calc
    const birthEl = document.getElementById("birthdate");
    const ageEl = document.getElementById("age");
    birthEl.addEventListener("change", () => {
      const b = new Date(birthEl.value),
        t = new Date();
      let age = t.getFullYear() - b.getFullYear();
      if (
        t.getMonth() < b.getMonth() ||
        (t.getMonth() === b.getMonth() && t.getDate() < b.getDate())
      )
        age--;
      ageEl.value = age >= 0 ? age : "";
    });

    // ===== Validation =====
    function requiredInputsIn(sectionEl) {
      return sectionEl.querySelectorAll("input[required], select[required]");
    }
    function validateStep(sectionEl) {
      const fields = requiredInputsIn(sectionEl);
      for (const el of fields) {
        if (!el.value) {
          el.reportValidity?.();
          el.focus();
          return false;
        }
      }
      if (sectionEl.id === "personalStep") {
        const pw = document.getElementById("password").value.trim();
        if (pw.length < 6) {
          alert("Password must be at least 6 characters");
          return false;
        }
      }
      if (sectionEl.id === "proStep") {
        const status = document.getElementById("employmentStatus").value;
        const employer = (
          document.getElementById("employer").value || ""
        ).trim();
        if (!status) {
          alert("Select employment status");
          return false;
        }
        if (status === "Employed" && !employer) {
          alert("Enter company");
          return false;
        }
      }
      return true;
    }

    // ===== Sign up flows =====
    async function signUpFlow(isInstallerFlow) {
      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;
      const birthdate = document.getElementById("birthdate").value;
      const age = Number(document.getElementById("age").value || 0);
      const phone = document.getElementById("phone").value.trim();

      const profession = document.getElementById("profession").value.trim();
      const highestQualification = document.getElementById(
        "highestQualification"
      ).value;
      const employment = document.getElementById("employmentStatus").value;
      const employer = document.getElementById("employer").value.trim();
      const mainIncomeSource = document
        .getElementById("mainIncomeSource")
        .value.trim();
      const bankName = document.getElementById("bankName").value.trim();
      const accountNumber = document
        .getElementById("accountNumber")
        .value.trim();
      const accountHolder = document
        .getElementById("accountHolder")
        .value.trim();

      try {
        const { data: authData, error: authError } =
          await supabase.auth.signUp({
            email,
            password,
            options: {
              data: { role: selectedRole, name, phone },
              emailRedirectTo: "https://simp-project-tan.vercel.app/login.html", // ← redirect after confirming email
            },
          });

        if (authError) throw authError;
        const userId = authData.user.id;

        const table = selectedRole === "installer" ? "installer" : "customer";
        const base = {
          id: userId,
          email,
          name,
          birthdate,
          age,
          phone,
          createdAt: new Date().toISOString(),
        };
        const payload = isInstallerFlow
          ? {
            ...base,
            profession,
            highestQualification,
            employmentStatus: employment || null,
            employer: employment === "Employed" ? employer || null : null,
            mainIncomeSource: mainIncomeSource || null,
            bankName: bankName || null,
            accountNumber: accountNumber || null,
            accountHolder: accountHolder || null,
          }
          : base;

        const { error: insertError } = await supabase
          .from(table)
          .insert([payload]);
        if (insertError) throw insertError;

        // Modal -> proceed to login
        const modal = document.getElementById("emailConfirmModal");
        const modalMsg = modal.querySelector("p");
        const modalBtn = document.getElementById("goToEmailBtn");
        modalMsg.textContent =
          "Your account was created. Please check your inbox for the confirmation link. After confirming, you can log in.";
        modalBtn.textContent = "Proceed to Login";
        modalBtn.onclick = () => {
          window.location.href = "login.html";
        };
        modal.style.display = "flex";
      } catch (err) {
        console.error(err);
        alert("Error: " + (err.message || "Failed to sign up"));
      }
    }

    document
      .getElementById("signUpNow")
      .addEventListener("click", async () => {
        if (!validateStep(document.getElementById("personalStep"))) return;
        await signUpFlow(false);
      });
    document
      .getElementById("signUpBtn")
      .addEventListener("click", async () => {
        if (!validateStep(document.getElementById("bankStep"))) return;
        await signUpFlow(true);
      });

    // Stepper logic
    function updateStepper() {
      const isInstaller = selectedRole === "installer";
      progressWrap.classList.toggle("hidden", !isInstaller);
      if (!isInstaller) return;

      const map = { personalStep: 0, proStep: 1, bankStep: 2 };
      const active = document.querySelector(".form-step.active");
      const idx = map[active?.id] ?? 0;

      const steps = Array.from(document.querySelectorAll(".stepper .step"));
      steps.forEach((s, i) => {
        s.classList.toggle("active", i === idx);
        s.classList.toggle("done", i < idx);
      });

      const c01 = document.getElementById("conn01");
      const c12 = document.getElementById("conn12");
      c01.className = "connector " + (idx === 0 ? "fill-0" : "fill-100");
      c12.className =
        "connector " +
        (idx < 2 ? (idx === 1 ? "fill-50" : "fill-0") : "fill-100");
    }

    // Mode & flow selectors (side panels / tabs)
    function setModeFromRole(role) {
      const body = document.body;
      if (role === "installer") {
        body.classList.add("mode-installer");
        body.classList.remove("mode-customer");
      } else {
        body.classList.add("mode-customer");
        body.classList.remove("mode-installer");
      }

      // Toggle mobile tab active state
      const tabC = document.getElementById("tabCustomer");
      const tabI = document.getElementById("tabInstaller");
      if (tabC && tabI) {
        tabC.classList.toggle("active", role === "customer");
        tabI.classList.toggle("active", role === "installer");
      }

      updateStepper();
    }

    function applyFlowForRole(role) {
      const installer = role === "installer";
      document
        .getElementById("proStep")
        .classList.toggle("skipped", !installer);
      document
        .getElementById("bankStep")
        .classList.toggle("skipped", !installer);
      document.getElementById("next1").classList.toggle("hidden", !installer);
      document
        .getElementById("signUpNow")
        .classList.toggle("hidden", installer);
      updateStepper();
    }

    window.chooseInstallerSignup = () => {
      selectedRole = "installer";
      setModeFromRole(selectedRole);
      applyFlowForRole(selectedRole);
      updateRolePill(selectedRole);
      showStepByIndex(0);
    };

    window.chooseCustomerSignup = () => {
      selectedRole = "customer";
      setModeFromRole(selectedRole);
      applyFlowForRole(selectedRole);
      updateRolePill(selectedRole);
      showStepByIndex(0);
    };

    // Default to customer view on load
    window.chooseCustomerSignup();
  </script>
</body>

</html>